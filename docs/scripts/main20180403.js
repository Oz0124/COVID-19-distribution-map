"use strict";var OO=OO||{};OO.Modules=OO.Modules||{},OO.Modules.ModalComponent=function(t,e){var a=OO.Modules.ModalComponent.prototype._init,n=a(t,e);this.show=n.show},OO.Modules.ModalComponent.prototype._init=function(t,e){var a=e.append("div").attr("class","modal fade"),n=a.append("div").attr("class","modal-dialog"),o=n.append("div").attr("class","modal-content"),i=o.append("div").attr("class","modal-header");return i.append("button").attr("type","button").attr("class","close").attr("data-dismiss","modal").append("span").attr("aria-hidden","true").text("×"),i.append("h4").attr("class","modal-title"),o.append("div").attr("class","modal-body"),o.append("div").attr("class","modal-footer").append("button").attr("type","button").attr("class","btn btn-default").attr("data-dismiss","modal").text("OK"),{show:function(t,e){i.select(".modal-title").text(t),o.select(".modal-body").text(e),$(a.node()).modal("show")}}};var OO=OO||{};OO.Modules=OO.Modules||{},OO.Modules.DisplayPanel=function(t,e){var a=OO.Modules.DisplayPanel.prototype._init;a(t,e)},OO.Modules.DisplayPanel.prototype._init=function(t,e){return{}};var OO=OO||{};OO.Service=OO.Service||{},function(){OO.Service.getTaiwanGeojson=function(){return $.ajax({url:"map/twCounty2010.geo.json",type:"GET",data:{}})},OO.Service.getCovid19Data=function(t){return $.ajax({url:"https://cors-anywhere.herokuapp.com/http://od.cdc.gov.tw/eic/Day_Confirmation_Age_County_Gender_19CoV.json",type:"GET",data:t})}}(),OO.Data=OO.Data||{},$(document).ready(function(){OO.Data.areaInfo=[];var t=d3.select("body"),e=t.select(".body-container .main .map"),a=t.select(".total-diagnose-block .diagnose-value"),n=t.select(".info-swiper-container"),o=echarts.init(e.node()),i=new OO.Modules.ModalComponent({},t),r=!1,s={title:{text:"臺灣各縣市確診人數統計",subtext:"Data from 衛生福利部疾病管制署 https://data.cdc.gov.tw/",sublink:"https://data.cdc.gov.tw/dataset/agsdctable-day-19cov"},tooltip:{trigger:"item",showDelay:0,transitionDuration:.2,formatter:function(t){var e=isNaN(t.value)?0:t.value;return t.name+"確診人數: "+e}},visualMap:{left:"right",min:0,max:600,text:["High","Low"],calculable:!0},series:[{name:"各地確診人數",type:"map",roam:!0,mapType:"taiwan",emphasis:{label:{show:!0}},data:[]}]},d=function(t,e){var a=t.select(".swiper-wrapper");return e.forEach(function(t){var e=a.append("div").classed("swiper-slide info-block",!0).attr("nid",t.name),n=e.append("div").classed("info-body",!0);n.append("div").classed("title-header",!0).text(t.name+"確診人數"),n.append("div").classed("diagnose-value",!0).text(t.value)}),new Swiper(t.node(),{spaceBetween:0,centeredSlides:!0,autoplay:{delay:3e3,disableOnInteraction:!1}})},l=function(t){OO.Service.getCovid19Data({}).then(function(e){var i=[],r=0;e.forEach(function(t){var e=t["縣市"],a=parseInt(t["確定病例數"]||0),o=null;r+=a,i.forEach(function(t){e===t.name&&(o=t)}),o?o.value+=a:(o={name:e,value:a},i.push(o)),n.select('.info-block[nid="'+o.name+'"] .diagnose-value').text(o.value)}),a.text(r),s.series[0].data=i,o.setOption(s),t&&t()},function(t){r=!0,i.show("Error","Ajax request error!")})};o.showLoading(),OO.Service.getTaiwanGeojson().then(function(t){echarts.registerMap("taiwan",t),t.features.forEach(function(t){OO.Data.areaInfo.push({name:t.properties.name,value:0})}),d(n,OO.Data.areaInfo),l(function(){o.hideLoading(),setInterval(function(){r||l()},1e4)})},function(t){i.show("Error","Ajax request error!")})});